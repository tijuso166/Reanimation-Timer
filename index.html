<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Reanimation">
  <title>Reanimations-Timer</title>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }
    * {
      -webkit-tap-highlight-color: transparent;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Lucide Icons als inline SVG
    const Play = ({size = 24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
    );
    const Pause = ({size = 24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
    );
    const RotateCcw = ({size = 24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="1 4 1 10 7 10"></polyline><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></svg>
    );
    const Activity = ({size = 24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>
    );
    const Zap = ({size = 24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
    );
    const Syringe = ({size = 24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m18 2 4 4"></path><path d="m17 7 3-3"></path><path d="M19 9 8.7 19.3c-1 1-2.5 1-3.4 0l-.6-.6c-1-1-1-2.5 0-3.4L15 5"></path><path d="m9 11 4 4"></path><path d="m5 19-3 3"></path><path d="m14 4 6 6"></path></svg>
    );
    const Heart = ({size = 24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"></path></svg>
    );
    const Info = ({size = 24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
    );

    function ReanimationTimer() {
      const [isRunning, setIsRunning] = useState(false);
      const [time, setTime] = useState(0);
      const [events, setEvents] = useState([]);
      const [swipedEventId, setSwipedEventId] = useState(null);
      const [showRhythmMenu, setShowRhythmMenu] = useState(false);
      const [showEventsMenu, setShowEventsMenu] = useState(false);
      const [showInfo, setShowInfo] = useState(false);
      const [showAdrenalinInfo, setShowAdrenalinInfo] = useState(false);
      const [showAmiodaronInfo, setShowAmiodaronInfo] = useState(false);
      const [lastShock, setLastShock] = useState(null);
      const [lastAdrenalin, setLastAdrenalin] = useState(null);
      const [lastAmiodaron, setLastAmiodaron] = useState(null);
      const [shockCount, setShockCount] = useState(0);

      const rhythms = [
        { label: 'Kammerflimmern (VF)', type: 'vf' },
        { label: 'Kammertachykardie (VT)', type: 'vt' },
        { label: 'Asystolie', type: 'asystole' },
        { label: 'PEA', type: 'pea' },
      ];

      const otherEvents = [
        { label: 'Intubation', type: 'intubation' },
        { label: 'Larynxmaske', type: 'larynxmask' },
        { label: 'LUCAS o.ä.', type: 'lucas' },
        { label: 'ECMO', type: 'ecmo' },
        { label: 'Abbruch der Reanimation', type: 'abort' },
        { label: 'Vektor-Change', type: 'vector' },
      ];

      const eventButtons = [
        { label: 'Rhythmuskontrolle', icon: Activity, color: 'bg-blue-500', type: 'rhythm', hasSubmenu: true, submenuItems: rhythms },
        { label: 'Schock abgegeben', icon: Zap, color: 'bg-red-500', type: 'shock', tracked: true },
        { label: 'Adrenalin', icon: Syringe, color: 'bg-green-500', type: 'adrenalin', tracked: true, hasInfo: true },
        { label: 'Amiodaron', icon: Syringe, color: 'bg-purple-500', type: 'amiodaron', tracked: true, shockBased: true, hasInfo: true },
        { label: 'Ereignisse', icon: Activity, color: 'bg-orange-500', type: 'events', hasSubmenu: true, submenuItems: otherEvents, noMainLog: true },
        { label: 'ROSC', icon: Heart, color: 'bg-pink-500', type: 'rosc' },
      ];

      useEffect(() => {
        let interval;
        if (isRunning) {
          interval = setInterval(() => {
            setTime(prevTime => prevTime + 1);
          }, 1000);
        }
        return () => clearInterval(interval);
      }, [isRunning]);

      const formatTime = (seconds) => {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
      };

      const playBeep = () => {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = 800;
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.1);
      };

      const addEvent = (eventType, label) => {
        const newEvent = {
          id: Date.now() + Math.random(),
          type: eventType,
          label: label,
          time: time,
          timestamp: new Date().toLocaleTimeString('de-DE')
        };
        setEvents(prev => [newEvent, ...prev]);
        playBeep();
        
        if (eventType === 'shock') {
          setLastShock(time);
          setShockCount(prev => prev + 1);
        }
        if (eventType === 'adrenalin') setLastAdrenalin(time);
        if (eventType === 'amiodaron') setLastAmiodaron(time);
      };

      const deleteEvent = (eventId) => {
        setEvents(prev => prev.filter(event => event.id !== eventId));
        setSwipedEventId(null);
      };

      const handleSubmenuSelect = (item, menuType) => {
        addEvent(item.type, item.label);
        if (menuType === 'rhythm') setShowRhythmMenu(false);
        if (menuType === 'events') setShowEventsMenu(false);
      };

      const toggleSubmenu = (menuType) => {
        if (menuType === 'rhythm') {
          setShowRhythmMenu(!showRhythmMenu);
        } else if (menuType === 'events') {
          setShowEventsMenu(!showEventsMenu);
        }
      };

      const reset = () => {
        if (window.confirm('Timer und alle Events zurücksetzen?')) {
          setIsRunning(false);
          setTime(0);
          setEvents([]);
          setLastShock(null);
          setLastAdrenalin(null);
          setLastAmiodaron(null);
          setShockCount(0);
          setShowRhythmMenu(false);
          setShowEventsMenu(false);
          setShowAdrenalinInfo(false);
          setShowAmiodaronInfo(false);
        }
      };

      const toggleTimer = () => {
        setIsRunning(!isRunning);
        if (!isRunning) playBeep();
      };

      const getTimeSince = (lastTime) => {
        if (lastTime === null) return null;
        return time - lastTime;
      };

      return (
        <div className="min-h-screen bg-gray-900 text-white p-4">
          <div className="max-w-md mx-auto">
            <div className="text-center mb-6">
              <h1 className="text-2xl font-bold mb-2">Reanimations-Timer</h1>
            </div>

            <div className="bg-gray-800 rounded-lg p-8 mb-6 text-center">
              <div className="text-7xl font-mono font-bold mb-6 tracking-wider">
                {formatTime(time)}
              </div>
              
              <div className="flex gap-3 justify-center">
                <button
                  onClick={toggleTimer}
                  className={`flex items-center gap-2 px-6 py-3 rounded-lg font-semibold text-lg ${
                    isRunning ? 'bg-yellow-600 hover:bg-yellow-700' : 'bg-green-600 hover:bg-green-700'
                  } transition-colors`}
                >
                  {isRunning ? <Pause size={24} /> : <Play size={24} />}
                  {isRunning ? 'Pause' : 'Start'}
                </button>
                
                <button
                  onClick={reset}
                  className="flex items-center gap-2 px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg font-semibold text-lg transition-colors"
                >
                  <RotateCcw size={24} />
                  Reset
                </button>
              </div>
            </div>

            <div className="bg-gray-800 rounded-lg p-4 mb-6">
              <h2 className="text-lg font-semibold mb-4">Ereignisse dokumentieren</h2>
              <div className="grid grid-cols-1 gap-3">
                {eventButtons.map((btn) => (
                  <div key={btn.type}>
                    {btn.hasSubmenu ? (
                      <div>
                        {btn.noMainLog ? (
                          <button
                            onClick={() => toggleSubmenu(btn.type)}
                            className={`w-full flex items-center justify-between px-4 py-3 ${btn.color} hover:opacity-90 rounded-lg font-semibold transition-opacity`}
                          >
                            <div className="flex items-center gap-3">
                              <btn.icon size={20} />
                              {btn.label}
                            </div>
                            <span className="text-xl">{
                              (btn.type === 'events' && showEventsMenu) ? '▲' : '▼'
                            }</span>
                          </button>
                        ) : (
                          <div className="flex gap-2">
                            <button
                              onClick={() => addEvent(btn.type, btn.label)}
                              className={`flex-1 flex items-center gap-3 px-4 py-3 ${btn.color} hover:opacity-90 rounded-lg font-semibold transition-opacity`}
                            >
                              <btn.icon size={20} />
                              {btn.label}
                            </button>
                            <button
                              onClick={() => toggleSubmenu(btn.type)}
                              className={`px-4 py-3 ${btn.color} hover:opacity-90 rounded-lg font-semibold transition-opacity border-l-2 border-black/20`}
                            >
                              <span className="text-xl">{
                                (btn.type === 'rhythm' && showRhythmMenu) ? '▲' : '▼'
                              }</span>
                            </button>
                          </div>
                        )}
                        {((btn.type === 'rhythm' && showRhythmMenu) || (btn.type === 'events' && showEventsMenu)) && (
                          <div className="mt-2 ml-4 space-y-2">
                            {btn.submenuItems.map((item) => (
                              <button
                                key={item.type}
                                onClick={() => handleSubmenuSelect(item, btn.type)}
                                className="w-full text-left px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors"
                              >
                                {item.label}
                              </button>
                            ))}
                          </div>
                        )}
                      </div>
                    ) : (
                      <div className="flex gap-2">
                        <button
                          onClick={() => addEvent(btn.type, btn.label)}
                          className={`flex-1 flex items-center justify-between px-4 py-3 ${btn.color} hover:opacity-90 rounded-lg font-semibold transition-opacity`}
                        >
                          <div className="flex items-center gap-3">
                            <btn.icon size={20} />
                            {btn.label}
                            {btn.shockBased && shockCount > 0 && (
                              <span className="text-sm opacity-80">
                                (nach <Zap size={14} className="inline" />{shockCount})
                              </span>
                            )}
                          </div>
                          <div className="flex items-center gap-3">
                            {btn.type === 'shock' && shockCount > 0 && (
                              <div className="flex items-center gap-1 text-sm font-bold">
                                <Zap size={16} />
                                <span>{shockCount}</span>
                              </div>
                            )}
                            {btn.tracked && (
                              <div className="text-sm font-mono">
                                {btn.type === 'shock' && lastShock !== null && (
                                  <span>{formatTime(getTimeSince(lastShock))}</span>
                                )}
                                {btn.type === 'adrenalin' && lastAdrenalin !== null && (
                                  <span>{formatTime(getTimeSince(lastAdrenalin))}</span>
                                )}
                                {btn.type === 'amiodaron' && lastAmiodaron !== null && (
                                  <span>{formatTime(getTimeSince(lastAmiodaron))}</span>
                                )}
                              </div>
                            )}
                          </div>
                        </button>
                        {btn.hasInfo && (
                          <button
                            onClick={() => {
                              if (btn.type === 'adrenalin') setShowAdrenalinInfo(!showAdrenalinInfo);
                              if (btn.type === 'amiodaron') setShowAmiodaronInfo(!showAmiodaronInfo);
                            }}
                            className="px-3 py-3 bg-gray-600 hover:bg-gray-500 rounded-lg transition-colors"
                          >
                            <Info size={18} />
                          </button>
                        )}
                      </div>
                    )}
                    {btn.type === 'adrenalin' && showAdrenalinInfo && (
                      <div className="mt-2 p-3 bg-gray-700 rounded-lg text-sm text-gray-300">
                        <p className="font-semibold text-white mb-1">Adrenalin 1mg:</p>
                        <p className="text-xs">• Nicht-defibrillierbar (Asystolie/PEA): ASAP, dann alle 4 Min</p>
                        <p className="text-xs">• Defibrillierbar (VF/VT): nach 3. Schock, dann alle 4 Min</p>
                      </div>
                    )}
                    {btn.type === 'amiodaron' && showAmiodaronInfo && (
                      <div className="mt-2 p-3 bg-gray-700 rounded-lg text-sm text-gray-300">
                        <p className="font-semibold text-white mb-1">Amiodaron:</p>
                        <p className="text-xs">• 300mg nach 3. Schock</p>
                        <p className="text-xs">• 150mg nach 5. Schock</p>
                        <p className="text-xs mt-1">(Alternative: Lidocain 100mg/50mg)</p>
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </div>

            <div className="flex justify-center mb-6">
              <button
                onClick={() => setShowInfo(!showInfo)}
                className="w-12 h-12 rounded-full bg-gray-600 hover:bg-gray-500 flex items-center justify-center transition-colors"
                title="Informationen"
              >
                <Info size={24} />
              </button>
            </div>

            {showInfo && (
              <div className="bg-gray-800 rounded-lg p-4 mb-6 max-h-96 overflow-y-auto">
                <h2 className="text-lg font-semibold mb-4">ℹ️ Information</h2>
                <div className="grid grid-cols-2 gap-4 text-sm">
                  <div className="space-y-2 text-gray-300">
                    <p className="font-semibold text-white mb-2">4 Hs:</p>
                    <div className="space-y-2">
                      <div>
                        <p className="text-xs font-semibold text-yellow-300">Hypoxie</p>
                        <p className="text-xs">→ Beatmung mit FiO₂ 100%</p>
                      </div>
                      <div>
                        <p className="text-xs font-semibold text-yellow-300">Hypovolämie</p>
                        <p className="text-xs">→ 500ml Volumen (VEL), dann nach Bedarf / Klinik</p>
                        <p className="text-xs">→ Blutung stoppen, Massivtransfusion, Gerinnungstherapie</p>
                      </div>
                      <div>
                        <p className="text-xs font-semibold text-yellow-300">Hyperkaliämie</p>
                        <p className="text-xs">→ Calciumgluconat 10% 30ml iv. oder Calciumchlorid 10% 10ml iv.</p>
                        <p className="text-xs">→ Natriumbikarbonat 8,4% 50 mmol (=ml) iv. KI</p>
                      </div>
                      <div>
                        <p className="text-xs font-semibold text-yellow-300">Hypokaliämie</p>
                        <p className="text-xs">→ Kaliumchlorid 20mmol über 2-3 Min iv., danach 10mmol über 2 Min iv.</p>
                      </div>
                      <div>
                        <p className="text-xs font-semibold text-yellow-300">Hypoglykämie</p>
                        <p className="text-xs">→ Glukose 40% 30ml iv. (12g)</p>
                      </div>
                      <div>
                        <p className="text-xs font-semibold text-yellow-300">Hypothermie</p>
                        <p className="text-xs">→ Temperaturkontrolle, eCPR erwägen</p>
                      </div>
                    </div>
                  </div>
                  
                  <div className="space-y-2 text-gray-300">
                    <p className="font-semibold text-white mb-2">HITS:</p>
                    <div className="space-y-2">
                      <div>
                        <p className="text-xs font-semibold text-red-300">Herzbeuteltamponade</p>
                        <p className="text-xs">→ Entlastungspunktion (bei Trauma ggf. Thorakotomie)</p>
                      </div>
                      <div>
                        <p className="text-xs font-semibold text-red-300">Intoxikation</p>
                        <p className="text-xs">→ Antidot falls verfügbar; eCPR erwägen</p>
                      </div>
                      <div>
                        <p className="text-xs font-semibold text-red-300">Thrombose (LAE/OMI)</p>
                        <p className="text-xs">→ V.a. LAE: Lyse (dann mind. 60-90min. CPR)</p>
                        <p className="text-xs">→ V.a. OMI (Myokardinfarkt): Evtl. unter laufender CPR Herzkatheter</p>
                      </div>
                      <div>
                        <p className="text-xs font-semibold text-red-300">Spannungspneumothorax</p>
                        <p className="text-xs">→ Entlastungspunktion, dann Drainage</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            )}

            {events.length > 0 && (
              <div className="bg-gray-800 rounded-lg p-4">
                <h2 className="text-lg font-semibold mb-4">Ereignis-Log</h2>
                <div className="space-y-2 max-h-64 overflow-y-auto">
                  {events.map((event) => (
                    <div key={event.id} className="relative">
                      <div className="bg-gray-700 rounded p-3 flex justify-between items-center">
                        <div className="flex-1">
                          <div className="font-semibold">{event.label}</div>
                          <div className="text-sm text-gray-400">{event.timestamp}</div>
                        </div>
                        <div className="flex items-center gap-3">
                          <div className="text-xl font-mono font-bold text-blue-400">
                            {formatTime(event.time)}
                          </div>
                          <button
                            onClick={() => deleteEvent(event.id)}
                            className="p-1 hover:bg-red-600 rounded transition-colors"
                            title="Löschen"
                          >
                            <span className="text-red-400 hover:text-white text-xl leading-none">×</span>
                          </button>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.render(<ReanimationTimer />, document.getElementById('root'));
  </script>
</body>
</html>
